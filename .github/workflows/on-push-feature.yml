name: Push on Feature Branch

on: 
    push:
        branches:
            - '**'
            - '!main'

jobs:
    feature-push:
        name: Build
        runs-on: ubuntu-24.04
        steps:
            - name: Setup Java
              uses: actions/setup-java@v4
              with:
                distribution: 'temurin'
                java-version: 21

            - name: Setup Gradle
              uses: gradle/actions/setup-gradle@v4

            - name: Get the artifact version
              id: versions
              uses: keeonline/gh-actions/actions/artifact-version@v0.0.2

            - name: Build application with Gradle
              run: |
                ./gradlew -Pversion=${{steps.versions.outputs.branch}} build --no-daemon

            - name: Show builds outputs
              run: |
                ls -lsa build/libs

            - name: Upload build reports
              uses: actions/upload-artifact@v4
              with:
                name: Build Reports
                path: build/reports

            - name: Build image
              run: |
                docker build --build-arg VERSION=${{steps.versions.outputs.branch}} \
                             -t chameleon:${{steps.versions.outputs.branch}} \
                             .

            - name: List image
              run: |
                docker image ls chameleon:${{steps.versions.outputs.branch}}

            - name: Inspect image
              run: |
                docker inspect --type=image chameleon:${{steps.versions.outputs.branch}}
            